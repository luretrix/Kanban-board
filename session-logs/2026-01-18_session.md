# Øktlogg: 2026-01-18

## Oversikt
- **Type:** Bugfiks og oppsett
- **Bruker:** Ny med terminal + Claude Code

## Hovedoppgaver utført

### Bugfiks (13+ bugs)
1. Race condition i `onCloseRequested` (columns i dependency array)
2. Race condition mellom autosave og manual save
3. State mutation i drag & drop (shallow copy → deep copy)
4. Manglende try-catch ved JSON.parse
5. Drag & drop resetter ikke `draggedItem`
6. Task drawer viser slettede tasks
7. Checklist ID collision (`Date.now()` → `crypto.randomUUID()`)
8. Backup rotation uten feillogging
9. `progressPct` vs checklist inconsistency
10. Settings modal loading states
11. Path handling (manuell → Tauri API)
12. `newTaskTemplate` useMemo (timestamps)
13. Input sanitization

### Tauri v2 API-oppdateringer
- `new Store()` → `Store.load()`
- `fs.createDir()` → `fs.mkdir()`
- Permissions må ha egen scope per operasjon

### Autosave-system
- Fjernet debounce - umiddelbar lagring
- Implementert `stableStringify()` for konsistent JSON-sammenligning
- `lastSavedColumnsRef` for å unngå duplikate lagringer
- `draggedItemRef` (ref, ikke state) for å unngå re-renders under drag

### Performance
- React.memo på Board, Column, Card
- useCallback på drag handlers
- Vite config: ignorer JSON-filer for å unngå reload

### Prosjektoppsett
- Git initialisert
- CLAUDE.md opprettet
- GitHub repo: https://github.com/luretrix/Kanban-board
- Session-closer agent konfigurert

## Viktige beslutninger
1. **Autosave uten debounce** - lagrer umiddelbart ved endring
2. **Backup kun ved manuell lagring** - ikke ved autosave
3. **Ingen close handler** - autosave håndterer alt
4. **stableStringify** - rekursiv JSON med sorterte nøkler

## Filer endret
- `src/App.jsx` - Hovedlogikk, autosave, drag & drop
- `src/storage/persistence.js` - Tauri v2 API, backup-system
- `src/components/TaskDrawer.jsx` - Sanitization, checklist ID
- `src/components/Board.jsx` - React.memo
- `src/components/Column.jsx` - React.memo
- `src/components/Card.jsx` - React.memo
- `src-tauri/capabilities/default.json` - Permissions med scope
- `vite.config.js` - Ignorer JSON i watch
- `.gitignore` - Ekskluder brukerdata

## Uløste issues / Neste økt
- (ingen kjente issues)

## Lærdom
- Tauri v2 har mange API-endringer fra v1
- React refs unngår re-renders bedre enn state for drag & drop
- JSON.stringify gir ikke konsistent output (objektnøkler)
- Vite watcher må konfigureres for å unngå reload ved filendringer
